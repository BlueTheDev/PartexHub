<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PartexHub Full Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Montserrat&family=Lobster&family=Open+Sans&family=Pacifico&family=Fira+Code&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        /* ---------------- Grundlayout ---------------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
            transition: 0.3s;
            overflow-x: hidden;
        }
        
        body.dark {
            background: #121212;
            color: white;
        }
        
        header {
            background: #1e1e1e;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            letter-spacing: 1px;
        }
        
        header .buttons {
            display: flex;
            gap: 10px;
        }
        
        header button {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            cursor: pointer;
            transition: 0.3s;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        header button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .theme-toggle {
            background: linear-gradient(135deg, #ff512f, #dd2476);
        }
        
        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            padding: 40px;
            justify-content: center;
            transition: 0.5s;
        }
        
        .app-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            width: 220px;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            cursor: pointer;
            position: relative;
            transition: 0.5s;
        }
        
        .app-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 36px rgba(0,0,0,0.25);
        }
        
        .app-card h2 {
            margin-top: 15px;
            font-size: 18px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .app-card img {
            width: 60px;
            height: 60px;
        }
        
        .app-card .tooltip {
            position: absolute;
            bottom: -30px;
            font-size: 12px;
            background: rgba(0,0,0,0.75);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }
        
        .app-card:hover .tooltip {
            opacity: 1;
        }
        
        #app-container {
            display: none;
            padding: 20px;
            transition: 0.5s;
        }
        
        .menu-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            transition: 0.3s;
        }
        
        .menu-bar select, .menu-bar button, .menu-bar input[type=color] {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .menu-bar button:hover {
            background: #eee;
        }
        
        #editor {
            width: 100%;
            min-height: 500px;
            border-radius: 12px;
            border: 1px solid #ccc;
            padding: 20px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            overflow: auto;
            outline: none;
            transition: 0.3s;
        }
        
        body.dark #editor {
            background: #1e1e1e;
            color: white;
            border: 1px solid #444;
        }
        
        #slides-container {
            width: 100%;
            min-height: 500px;
            position: relative;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #ccc;
            overflow: hidden;
            display: none;
            transition: 0.5s;
        }
        
        .slide {
            display: none;
            width: 100%;
            height: 100%;
            padding: 25px;
            font-size: 20px;
            line-height: 1.5;
            font-family: 'Roboto', sans-serif;
            position: absolute;
            top: 0;
            left: 0;
            transition: all 0.5s;
            overflow: auto;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .slide.active {
            display: block;
        }
        
        .slide-textbox {
            padding: 10px;
            border: 1px solid #888;
            border-radius: 8px;
            background: rgba(255,255,255,0.85);
            position: absolute;
            cursor: move;
            user-select: none;
        }
        
        body.dark .slide-textbox {
            background: rgba(50,50,50,0.85);
            border: 1px solid #555;
        }
        
        #settings-panel {
            display: none;
            position: fixed;
            top: 60px;
            right: 0;
            width: 300px;
            background: white;
            border-left: 1px solid #ccc;
            height: calc(100% - 60px);
            padding: 20px;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
            z-index: 2000;
            transition: 0.4s;
        }
        
        body.dark #settings-panel {
            background: #1e1e1e;
            color: white;
            border-left: 1px solid #444;
        }
        
        .setting-item {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #auth-panel {
            padding: 50px;
            text-align: center;
        }
        
        #auth-panel input {
            padding: 10px 14px;
            margin: 6px;
            width: 80%;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        #auth-panel button {
            padding: 10px 14px;
            margin: 8px;
            width: 60%;
            border-radius: 8px;
            border: none;
            background: #1e90ff;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: 0.3s;
        }
        
        #auth-panel button:hover {
            transform: translateY(-2px);
            background: #187bcd;
        }
        
        #user-info {
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        /* Mail App Styles */
        #mail-container {
            display: none;
            width: 100%;
            height: 80vh;
            background: white;
            border-radius: 12px;
            border: 1px solid #ccc;
            overflow: hidden;
        }
        
        body.dark #mail-container {
            background: #1e1e1e;
            border: 1px solid #444;
        }
        
        .mail-sidebar {
            width: 250px;
            background: #f8f9fa;
            height: 100%;
            border-right: 1px solid #dee2e6;
            padding: 20px;
            float: left;
        }
        
        body.dark .mail-sidebar {
            background: #2d2d2d;
            border-right: 1px solid #444;
        }
        
        .mail-content {
            margin-left: 250px;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
        }
        
        .mail-folders {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .mail-folders li {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 5px;
            transition: 0.2s;
        }
        
        .mail-folders li:hover, .mail-folders li.active {
            background: #e9ecef;
        }
        
        body.dark .mail-folders li:hover, body.dark .mail-folders li.active {
            background: #3d3d3d;
        }
        
        .mail-list {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        body.dark .mail-list {
            border: 1px solid #444;
        }
        
        .mail-item {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .mail-item:hover {
            background: #f8f9fa;
        }
        
        body.dark .mail-item:hover {
            background: #2d2d2d;
        }
        
        .mail-item.unread {
            font-weight: bold;
            background: #e7f3ff;
        }
        
        body.dark .mail-item.unread {
            background: #1a3a5f;
        }
        
        .mail-item:last-child {
            border-bottom: none;
        }
        
        .mail-sender {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .mail-subject {
            margin-bottom: 5px;
        }
        
        .mail-preview {
            color: #6c757d;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mail-view {
            padding: 20px;
        }
        
        .mail-header {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .mail-actions {
            margin-bottom: 20px;
        }
        
        .compose-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .compose-btn:hover {
            background: #0056b3;
        }
        
        /* Neue Stile f√ºr zus√§tzliche Funktionen */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #4CAF50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 3000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.error {
            background: #f44336;
        }
        
        #word-count {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.1);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        #slide-counter {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.1);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .back-button {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .back-button:hover {
            background: #5a6268;
        }
        
        /* Email Setup Styles */
        #email-setup {
            display: none;
            padding: 30px;
            background: white;
            border-radius: 12px;
            margin: 20px;
            text-align: center;
        }
        
        body.dark #email-setup {
            background: #1e1e1e;
        }
        
        .email-option {
            display: inline-block;
            width: 200px;
            padding: 20px;
            margin: 10px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .email-option:hover {
            border-color: #007bff;
            transform: translateY(-5px);
        }
        
        .email-option.selected {
            border-color: #007bff;
            background: #e7f3ff;
        }
        
        body.dark .email-option.selected {
            background: #1a3a5f;
        }
    </style>
</head>
<body>
    <header>
        <h1>PartexHub</h1>
        <div class="buttons">
            <button onclick="goDashboard()">Dashboard</button>
            <button class="theme-toggle" onclick="toggleTheme()">Theme</button>
            <button onclick="toggleSettings()">Einstellungen</button>
        </div>
    </header>

    <div id="auth-panel">
        <div id="user-info"></div>
        <input type="email" id="email" placeholder="Email"><br>
        <input type="password" id="password" placeholder="Passwort"><br>
        <button onclick="signup()">Registrieren</button>
        <button onclick="login()">Login</button>
    </div>

    <div class="dashboard" id="dashboard" style="display:none;">
        <div class="app-card" onclick="openWriter()">
            <img src="https://img.icons8.com/ios-filled/50/000000/edit--v1.png"/>
            <h2>PartexWriter</h2>
            <div class="tooltip">Schreibe Texte wie ein Profi!</div>
        </div>
        <div class="app-card" onclick="openPresenter()">
            <img src="https://img.icons8.com/ios-filled/50/000000/presentation.png"/>
            <h2>PartexPresenter</h2>
            <div class="tooltip">Erstelle Pr√§sentationen!</div>
        </div>
        <div class="app-card" onclick="openMail()">
            <img src="https://img.icons8.com/ios-filled/50/000000/email.png"/>
            <h2>PartexMail</h2>
            <div class="tooltip">E-Mail Client mit @partex.com Adressen!</div>
        </div>
    </div>

    <div id="app-container">
        <!-- Writer Header -->
        <div class="app-header" id="writer-header" style="display:none;">
            <div class="app-title">PartexWriter</div>
            <button class="back-button" onclick="goDashboard()">Zur√ºck zum Dashboard</button>
        </div>
        
        <!-- Writer Menu -->
        <div class="menu-bar" id="writer-menu" style="display:none;">
            <select id="font-select" onchange="changeFont()">
                <option>Roboto</option><option>Montserrat</option><option>Lobster</option><option>Open Sans</option><option>Pacifico</option><option>Fira Code</option><option>Courier Prime</option>
            </select>
            <select id="font-size" onchange="changeFontSize()">
                <option value="12">12</option><option value="14">14</option><option value="16" selected>16</option><option value="18">18</option><option value="20">20</option><option value="22">22</option><option value="24">24</option><option value="28">28</option><option value="32">32</option>
            </select>
            <input type="color" id="text-color" onchange="changeColor()" title="Textfarbe">
            <input type="color" id="bg-color" onchange="changeBg()" title="Hintergrundfarbe">
            <button onclick="boldText()">B</button>
            <button onclick="italicText()">I</button>
            <button onclick="underlineText()">U</button>
            <button onclick="strikeText()">S</button>
            <button onclick="alignLeft()">‚¨Ö</button>
            <button onclick="alignCenter()">‚Üî</button>
            <button onclick="alignRight()">‚û°</button>
            <button onclick="justifyText()">‚õ∂</button>
            <button onclick="insertBullet()">‚Ä¢ Liste</button>
            <button onclick="insertNumber()">1. Liste</button>
            <button onclick="insertEmoji()">üòä</button>
            <button onclick="undo()">‚Ü∂</button>
            <button onclick="redo()">‚Ü∑</button>
            <button onclick="saveAs()">Speichern unter</button>
            <button onclick="newDocument()">Neu</button>
            <button onclick="openDocument()">√ñffnen</button>
            <button onclick="insertTable()">Tabelle</button>
            <button onclick="insertImage()">Bild</button>
            <button onclick="printDocument()">Drucken</button>
            <button onclick="findText()">Suchen</button>
        </div>

        <!-- Writer Editor -->
        <div id="editor" contenteditable="true" style="display:none;"></div>
        <div id="word-count"></div>

        <!-- Presenter Header -->
        <div class="app-header" id="presenter-header" style="display:none;">
            <div class="app-title">PartexPresenter</div>
            <button class="back-button" onclick="goDashboard()">Zur√ºck zum Dashboard</button>
        </div>
        
        <!-- Presenter -->
        <div class="menu-bar" id="presenter-menu" style="display:none;">
            <button onclick="prevSlide()">‚Üê</button>
            <button onclick="nextSlide()">‚Üí</button>
            <button onclick="addSlide()">Neue Folie</button>
            <button onclick="deleteSlide()">Folie l√∂schen</button>
            <input type="color" id="slide-bg" onchange="changeSlideBg()" title="Hintergrundfarbe">
            <button onclick="downloadSlides()">Download</button>
            <button onclick="fullscreenSlide()">Vollbild</button>
            <button onclick="addTextBox()">Textbox hinzuf√ºgen</button>
            <button onclick="removeTextBox()">Textbox entfernen</button>
            <button onclick="addImageToSlide()">Bild hinzuf√ºgen</button>
        </div>
        <div id="slides-container"></div>
        <div id="slide-counter"></div>

        <!-- Mail Header -->
        <div class="app-header" id="mail-header" style="display:none;">
            <div class="app-title">PartexMail</div>
            <button class="back-button" onclick="goDashboard()">Zur√ºck zum Dashboard</button>
        </div>
        
        <!-- Mail App -->
        <div id="mail-container" style="display:none;">
            <div class="mail-sidebar">
                <button class="compose-btn" onclick="composeEmail()">Neue E-Mail</button>
                <ul class="mail-folders">
                    <li class="active" onclick="showFolder('inbox')">Posteingang</li>
                    <li onclick="showFolder('sent')">Gesendet</li>
                    <li onclick="showFolder('drafts')">Entw√ºrfe</li>
                    <li onclick="showFolder('trash')">Papierkorb</li>
                </ul>
            </div>
            <div class="mail-content">
                <div id="mail-list-view">
                    <div class="mail-list" id="email-list">
                        <!-- Emails werden hier dynamisch geladen -->
                    </div>
                </div>
                <div id="mail-view" style="display:none;">
                    <div class="mail-actions">
                        <button onclick="backToInbox()">‚Üê Zur√ºck</button>
                        <button onclick="replyEmail()">Antworten</button>
                        <button onclick="deleteEmail()">L√∂schen</button>
                    </div>
                    <div class="mail-view" id="email-content">
                        <!-- Email-Inhalt wird hier angezeigt -->
                    </div>
                </div>
                <div id="compose-view" style="display:none;">
                    <div class="mail-actions">
                        <button onclick="backToInbox()">Abbrechen</button>
                        <button onclick="sendEmail()">Senden</button>
                    </div>
                    <div class="compose-form">
                        <input type="text" id="compose-to" placeholder="An" style="width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;">
                        <input type="text" id="compose-subject" placeholder="Betreff" style="width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;">
                        <textarea id="compose-body" placeholder="Nachricht" style="width:100%;height:300px;padding:10px;border:1px solid #ccc;border-radius:4px;"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Setup -->
        <div id="email-setup">
            <h2>W√§hlen Sie Ihre PartexMail Adresse</h2>
            <p>W√§hlen Sie einen Benutzernamen f√ºr Ihre @partex.com E-Mail Adresse</p>
            <div>
                <div class="email-option" onclick="selectEmailOption('vorname.nachname')">
                    <h3>vorname.nachname@partex.com</h3>
                    <p>Standard Format</p>
                </div>
                <div class="email-option" onclick="selectEmailOption('vornamenachname')">
                    <h3>vornamenachname@partex.com</h3>
                    <p>Ohne Punkte</p>
                </div>
                <div class="email-option" onclick="selectEmailOption('nickname')">
                    <h3>nickname@partex.com</h3>
                    <p>Spitzname</p>
                </div>
            </div>
            <div style="margin-top:20px;">
                <input type="text" id="custom-email" placeholder="Benutzerdefinierte Adresse" style="padding:10px;width:300px;border:1px solid #ccc;border-radius:4px;">
                <button onclick="useCustomEmail()" style="padding:10px 20px;background:#007bff;color:white;border:none;border-radius:4px;cursor:pointer;margin-left:10px;">Verwenden</button>
            </div>
            <button onclick="confirmEmail()" style="padding:10px 30px;background:#28a745;color:white;border:none;border-radius:6px;cursor:pointer;margin-top:20px;font-size:16px;">E-Mail Adresse best√§tigen</button>
        </div>

        <!-- Settings -->
        <div id="settings-panel">
            <h3>Einstellungen</h3>
            <div class="setting-item">
                <label>Autosave Writer</label>
                <input type="checkbox" id="autosave-writer" checked>
            </div>
            <div class="setting-item">
                <label>Autosave Presenter</label>
                <input type="checkbox" id="autosave-presenter" checked>
            </div>
            <div class="setting-item">
                <label>Default Font</label>
                <select id="default-font">
                    <option>Roboto</option><option>Montserrat</option><option>Lobster</option><option>Open Sans</option>
                </select>
            </div>
            <div class="setting-item">
                <label>Default Font Size</label>
                <select id="default-size">
                    <option>16</option><option>18</option><option>20</option>
                </select>
            </div>
            <div class="setting-item">
                <label>Sprachausgabe</label>
                <input type="checkbox" id="text-to-speech">
            </div>
            <div class="setting-item">
                <label>Rechtschreibpr√ºfung</label>
                <input type="checkbox" id="spell-check" checked>
            </div>
        </div>
    </div>

    <!-- Notification Element -->
    <div id="notification" class="notification"></div>

    <script>
        // ---------------- Auth Simulation ----------------
        let currentUser = null;
        let userEmailAddress = null;
        let selectedEmailOption = null;
        
        function updateUI(user) {
            const info = document.getElementById('user-info');
            if (user) {
                info.innerHTML = `Eingeloggt als: ${user.email} <button onclick="logout()">Logout</button>`;
                document.getElementById('auth-panel').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
                currentUser = user;
                
                // Check if user has email address
                userEmailAddress = localStorage.getItem(`partexmail-${user.email}`);
                if (!userEmailAddress) {
                    // Show email setup if no address exists
                    showEmailSetup();
                }
            } else {
                info.innerHTML = '';
                document.getElementById('auth-panel').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('app-container').style.display = 'none';
                document.getElementById('email-setup').style.display = 'none';
                currentUser = null;
                userEmailAddress = null;
            }
        }
        
        window.signup = function() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            
            if (!email || !pass) {
                showNotification('Bitte f√ºllen Sie alle Felder aus', 'error');
                return;
            }
            
            // Simuliere Registrierung
            const user = { email: email };
            updateUI(user);
            showNotification('Erfolgreich registriert!');
        };
        
        window.login = function() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            
            if (!email || !pass) {
                showNotification('Bitte f√ºllen Sie alle Felder aus', 'error');
                return;
            }
            
            // Simuliere Login
            const user = { email: email };
            updateUI(user);
            showNotification('Erfolgreich eingeloggt!');
        };
        
        window.logout = function() {
            updateUI(null);
            showNotification('Erfolgreich ausgeloggt!');
        };
        
        // Initial UI aufrufen
        updateUI(null);

        // ---------------- Dashboard ----------------
        function goDashboard() {
            document.getElementById('dashboard').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('writer-menu').style.display = 'none';
            document.getElementById('presenter-menu').style.display = 'none';
            document.getElementById('editor').style.display = 'none';
            document.getElementById('slides-container').style.display = 'none';
            document.getElementById('mail-container').style.display = 'none';
            document.getElementById('writer-header').style.display = 'none';
            document.getElementById('presenter-header').style.display = 'none';
            document.getElementById('mail-header').style.display = 'none';
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('email-setup').style.display = 'none';
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('partex-theme', document.body.classList.contains('dark') ? 'dark' : 'light');
            showNotification('Theme ge√§ndert');
        }
        
        function toggleSettings() {
            let panel = document.getElementById('settings-panel');
            panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        }

        // ---------------- Writer ----------------
        let undoStack = [], redoStack = [];
        
        function openWriter() {
            if (!currentUser) {
                showNotification('Bitte loggen Sie sich zuerst ein', 'error');
                return;
            }
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('writer-menu').style.display = 'flex';
            document.getElementById('presenter-menu').style.display = 'none';
            document.getElementById('editor').style.display = 'block';
            document.getElementById('slides-container').style.display = 'none';
            document.getElementById('mail-container').style.display = 'none';
            document.getElementById('writer-header').style.display = 'flex';
            document.getElementById('presenter-header').style.display = 'none';
            document.getElementById('mail-header').style.display = 'none';
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('email-setup').style.display = 'none';
            
            let content = localStorage.getItem('partex-content');
            document.getElementById('editor').innerHTML = content ? content : '';
            
            // Word Count aktualisieren
            updateWordCount();
            
            // Event Listener f√ºr Autosave
            if (document.getElementById('autosave-writer').checked) {
                document.getElementById('editor').addEventListener('input', autoSaveWriter);
            }
            
            // Event Listener f√ºr Word Count
            document.getElementById('editor').addEventListener('input', updateWordCount);
            
            showNotification('PartexWriter ge√∂ffnet');
        }

        function changeFont() {
            document.getElementById('editor').style.fontFamily = document.getElementById('font-select').value;
        }
        
        function changeFontSize() {
            document.getElementById('editor').style.fontSize = document.getElementById('font-size').value + 'px';
        }
        
        function changeColor() {
            document.execCommand('foreColor', false, document.getElementById('text-color').value);
        }
        
        function changeBg() {
            document.execCommand('backColor', false, document.getElementById('bg-color').value);
        }
        
        function boldText() {
            document.execCommand('bold');
        }
        
        function italicText() {
            document.execCommand('italic');
        }
        
        function underlineText() {
            document.execCommand('underline');
        }
        
        function strikeText() {
            document.execCommand('strikeThrough');
        }
        
        function alignLeft() {
            document.execCommand('justifyLeft');
        }
        
        function alignCenter() {
            document.execCommand('justifyCenter');
        }
        
        function alignRight() {
            document.execCommand('justifyRight');
        }
        
        function justifyText() {
            document.execCommand('justifyFull');
        }
        
        function insertBullet() {
            document.execCommand('insertUnorderedList');
        }
        
        function insertNumber() {
            document.execCommand('insertOrderedList');
        }
        
        function insertEmoji() {
            document.execCommand('insertText', false, 'üòä');
        }
        
        function undo() {
            document.execCommand('undo');
        }
        
        function redo() {
            document.execCommand('redo');
        }
        
        function saveAs() {
            let content = document.getElementById('editor').innerHTML;
            const blob = new Blob([content], {type: "text/html"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'PartexDocument.html';
            a.click();
            showNotification('Dokument gespeichert');
        }
        
        function newDocument() {
            document.getElementById('editor').innerHTML = '';
            localStorage.removeItem('partex-content');
            updateWordCount();
            showNotification('Neues Dokument erstellt');
        }
        
        function openDocument() {
            let input = document.createElement('input');
            input.type = 'file';
            input.accept = '.html,.txt';
            input.onchange = e => {
                let file = e.target.files[0];
                let reader = new FileReader();
                reader.onload = function(ev) {
                    document.getElementById('editor').innerHTML = ev.target.result;
                    updateWordCount();
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function insertTable() {
            let rows = prompt("Anzahl der Zeilen?", 2);
            let cols = prompt("Anzahl der Spalten?", 2);
            if (!rows || !cols) return;
            let table = '<table border="1" style="border-collapse:collapse; width:100%;">';
            for (let i = 0; i < rows; i++) {
                table += '<tr>';
                for (let j = 0; j < cols; j++) {
                    table += '<td>&nbsp;</td>';
                }
                table += '</tr>';
            }
            table += '</table>';
            document.execCommand('insertHTML', false, table);
        }
        
        function insertImage() {
            let input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = e => {
                let file = e.target.files[0];
                let reader = new FileReader();
                reader.onload = function(ev) {
                    document.execCommand('insertImage', false, ev.target.result);
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }
        
        function printDocument() {
            window.print();
        }
        
        function findText() {
            let search = prompt("Text suchen:");
            if (search) {
                let content = document.getElementById('editor').innerHTML;
                let regex = new RegExp(search, "gi");
                let newContent = content.replace(regex, match => `<mark>${match}</mark>`);
                document.getElementById('editor').innerHTML = newContent;
            }
        }
        
        function updateWordCount() {
            let text = document.getElementById('editor').innerText;
            let words = text.trim() ? text.trim().split(/\s+/).length : 0;
            let chars = text.length;
            document.getElementById('word-count').innerHTML = `W√∂rter: ${words} | Zeichen: ${chars}`;
        }
        
        function autoSaveWriter() {
            let content = document.getElementById('editor').innerHTML;
            localStorage.setItem('partex-content', content);
        }

        // ---------------- Presenter ----------------
        let slides = [], currentSlide = 0;
        
        function openPresenter() {
            if (!currentUser) {
                showNotification('Bitte loggen Sie sich zuerst ein', 'error');
                return;
            }
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('writer-menu').style.display = 'none';
            document.getElementById('presenter-menu').style.display = 'flex';
            document.getElementById('editor').style.display = 'none';
            document.getElementById('slides-container').style.display = 'block';
            document.getElementById('mail-container').style.display = 'none';
            document.getElementById('writer-header').style.display = 'none';
            document.getElementById('presenter-header').style.display = 'flex';
            document.getElementById('mail-header').style.display = 'none';
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('email-setup').style.display = 'none';
            
            if (slides.length === 0) addSlide();
            showSlide(currentSlide);
            updateSlideCounter();
            
            showNotification('PartexPresenter ge√∂ffnet');
        }
        
        function addSlide() {
            const slide = document.createElement('div');
            slide.className = 'slide';
            slide.contentEditable = true;
            slide.innerText = 'Neue Folie';
            document.getElementById('slides-container').appendChild(slide);
            slides.push(slide);
            currentSlide = slides.length - 1;
            showSlide(currentSlide);
            updateSlideCounter();
        }
        
        function deleteSlide() {
            if (slides.length <= 1) {
                showNotification('Mindestens eine Folie muss vorhanden sein', 'error');
                return;
            }
            
            slides[currentSlide].remove();
            slides.splice(currentSlide, 1);
            
            if (currentSlide >= slides.length) currentSlide = slides.length - 1;
            showSlide(currentSlide);
            updateSlideCounter();
        }
        
        function showSlide(index) {
            slides.forEach((s, i) => s.classList.remove('active'));
            if (slides[index]) slides[index].classList.add('active');
            updateSlideCounter();
        }
        
        function nextSlide() {
            if (currentSlide < slides.length - 1) currentSlide++;
            showSlide(currentSlide);
        }
        
        function prevSlide() {
            if (currentSlide > 0) currentSlide--;
            showSlide(currentSlide);
        }
        
        function addTextBox() {
            const tb = document.createElement('div');
            tb.contentEditable = true;
            tb.innerText = 'Textbox';
            tb.style.position = 'absolute';
            tb.style.top = '50px';
            tb.style.left = '50px';
            tb.style.padding = '10px';
            tb.style.background = 'rgba(255,255,255,0.8)';
            tb.style.border = '1px solid #ccc';
            tb.className = 'slide-textbox';
            if (slides[currentSlide]) slides[currentSlide].appendChild(tb);
            dragElement(tb);
        }
        
        function removeTextBox() {
            let tbs = document.querySelectorAll('.slide-textbox');
            if (tbs.length > 0) tbs[tbs.length - 1].remove();
        }
        
        function fullscreenSlide() {
            if (slides[currentSlide]) slides[currentSlide].requestFullscreen();
        }
        
        function changeSlideBg() {
            if (slides[currentSlide]) slides[currentSlide].style.background = document.getElementById('slide-bg').value;
        }
        
        function downloadSlides() {
            let content = slides.map(s => s.innerText).join('\n\n');
            const blob = new Blob([content], {type: "text/plain"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'PartexSlides.txt';
            a.click();
            showNotification('Pr√§sentation heruntergeladen');
        }
        
        function addImageToSlide() {
            let input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = e => {
                let file = e.target.files[0];
                let reader = new FileReader();
                reader.onload = function(ev) {
                    const img = document.createElement('img');
                    img.src = ev.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '100%';
                    img.style.position = 'absolute';
                    img.style.top = '50%';
                    img.style.left = '50%';
                    img.style.transform = 'translate(-50%, -50%)';
                    if (slides[currentSlide]) slides[currentSlide].appendChild(img);
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }
        
        function updateSlideCounter() {
            document.getElementById('slide-counter').innerHTML = `Folie ${currentSlide + 1} von ${slides.length}`;
        }

        // ---------------- Mail App ----------------
        let currentFolder = 'inbox';
        let emails = {
            inbox: [
                { id: 1, from: 'support@partex.com', to: userEmailAddress, subject: 'Willkommen bei PartexMail!', body: 'Herzlich willkommen bei Ihrem neuen PartexMail Account!', date: '2023-10-01', read: false },
                { id: 2, from: 'team@partex.com', to: userEmailAddress, subject: 'Ihre PartexMail ist aktiv', body: 'Ihr PartexMail Account wurde erfolgreich aktiviert. Sie k√∂nnen jetzt E-Mails senden und empfangen.', date: '2023-10-01', read: true }
            ],
            sent: [
                { id: 3, from: userEmailAddress, to: 'friend@example.com', subject: 'Test E-Mail', body: 'Dies ist eine Test-E-Mail von meinem neuen PartexMail Account!', date: '2023-10-01', read: true }
            ],
            drafts: [],
            trash: []
        };
        
        function openMail() {
            if (!currentUser) {
                showNotification('Bitte loggen Sie sich zuerst ein', 'error');
                return;
            }
            
            if (!userEmailAddress) {
                showEmailSetup();
                return;
            }
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('writer-menu').style.display = 'none';
            document.getElementById('presenter-menu').style.display = 'none';
            document.getElementById('editor').style.display = 'none';
            document.getElementById('slides-container').style.display = 'none';
            document.getElementById('mail-container').style.display = 'block';
            document.getElementById('writer-header').style.display = 'none';
            document.getElementById('presenter-header').style.display = 'none';
            document.getElementById('mail-header').style.display = 'flex';
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('email-setup').style.display = 'none';
            
            loadEmails();
            showNotification('PartexMail ge√∂ffnet');
        }
        
        function showEmailSetup() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('email-setup').style.display = 'block';
        }
        
        function selectEmailOption(option) {
            selectedEmailOption = option;
            document.querySelectorAll('.email-option').forEach(el => el.classList.remove('selected'));
            event.target.closest('.email-option').classList.add('selected');
        }
        
        function useCustomEmail() {
            const customEmail = document.getElementById('custom-email').value;
            if (customEmail) {
                selectedEmailOption = customEmail;
                document.querySelectorAll('.email-option').forEach(el => el.classList.remove('selected'));
                showNotification('Benutzerdefinierte E-Mail ausgew√§hlt');
            }
        }
        
        function confirmEmail() {
            if (!selectedEmailOption) {
                showNotification('Bitte w√§hlen Sie eine E-Mail Option aus', 'error');
                return;
            }
            
            let emailAddress;
            if (selectedEmailOption === 'vorname.nachname') {
                // Extract name from user email (everything before @)
                const namePart = currentUser.email.split('@')[0];
                emailAddress = namePart + '@partex.com';
            } else if (selectedEmailOption === 'vornamenachname') {
                const namePart = currentUser.email.split('@')[0].replace('.', '');
                emailAddress = namePart + '@partex.com';
            } else if (selectedEmailOption === 'nickname') {
                const namePart = currentUser.email.split('@')[0].split('.')[0];
                emailAddress = namePart + '@partex.com';
            } else {
                emailAddress = selectedEmailOption + '@partex.com';
            }
            
            userEmailAddress = emailAddress;
            localStorage.setItem(`partexmail-${currentUser.email}`, userEmailAddress);
            
            // Update emails with the new address
            emails.inbox[0].to = userEmailAddress;
            emails.inbox[1].to = userEmailAddress;
            emails.sent[0].from = userEmailAddress;
            
            showNotification(`Ihre PartexMail Adresse ist: ${userEmailAddress}`);
            openMail();
        }
        
        function showFolder(folder) {
            currentFolder = folder;
            document.querySelectorAll('.mail-folders li').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            loadEmails();
        }
        
        function loadEmails() {
            const emailList = document.getElementById('email-list');
            emailList.innerHTML = '';
            
            emails[currentFolder].forEach(email => {
                const emailItem = document.createElement('div');
                emailItem.className = `mail-item ${email.read ? '' : 'unread'}`;
                emailItem.onclick = () => viewEmail(email.id);
                
                emailItem.innerHTML = `
                    <div class="mail-sender">${email.from}</div>
                    <div class="mail-subject">${email.subject}</div>
                    <div class="mail-preview">${email.body.substring(0, 100)}...</div>
                `;
                
                emailList.appendChild(emailItem);
            });
            
            document.getElementById('mail-list-view').style.display = 'block';
            document.getElementById('mail-view').style.display = 'none';
            document.getElementById('compose-view').style.display = 'none';
        }
        
        function viewEmail(id) {
            const email = emails[currentFolder].find(e => e.id === id);
            if (email) {
                email.read = true;
                
                document.getElementById('email-content').innerHTML = `
                    <div class="mail-header">
                        <h3>${email.subject}</h3>
                        <p><strong>Von:</strong> ${email.from}</p>
                        <p><strong>An:</strong> ${email.to}</p>
                        <p><strong>Datum:</strong> ${email.date}</p>
                    </div>
                    <div class="mail-body">
                        <p>${email.body}</p>
                    </div>
                `;
                
                document.getElementById('mail-list-view').style.display = 'none';
                document.getElementById('mail-view').style.display = 'block';
                document.getElementById('compose-view').style.display = 'none';
                
                loadEmails(); // Refresh to update read status
            }
        }
        
        function backToInbox() {
            document.getElementById('mail-list-view').style.display = 'block';
            document.getElementById('mail-view').style.display = 'none';
            document.getElementById('compose-view').style.display = 'none';
        }
        
        function composeEmail() {
            document.getElementById('compose-to').value = '';
            document.getElementById('compose-subject').value = '';
            document.getElementById('compose-body').value = '';
            
            document.getElementById('mail-list-view').style.display = 'none';
            document.getElementById('mail-view').style.display = 'none';
            document.getElementById('compose-view').style.display = 'block';
        }
        
        function sendEmail() {
            const to = document.getElementById('compose-to').value;
            const subject = document.getElementById('compose-subject').value;
            const body = document.getElementById('compose-body').value;
            
            if (!to || !subject || !body) {
                showNotification('Bitte f√ºllen Sie alle Felder aus', 'error');
                return;
            }
            
            const newEmail = {
                id: Date.now(),
                from: userEmailAddress,
                to: to,
                subject: subject,
                body: body,
                date: new Date().toISOString().split('T')[0],
                read: true
            };
            
            emails.sent.push(newEmail);
            showNotification('E-Mail gesendet!');
            backToInbox();
        }
        
        function replyEmail() {
            const currentEmail = emails[currentFolder].find(e => e.id === parseInt(document.querySelector('.mail-header h3').dataset.id));
            if (currentEmail) {
                document.getElementById('compose-to').value = currentEmail.from;
                document.getElementById('compose-subject').value = `Re: ${currentEmail.subject}`;
                document.getElementById('compose-body').value = `\n\n--- Original Message ---\n${currentEmail.body}`;
                
                document.getElementById('mail-list-view').style.display = 'none';
                document.getElementById('mail-view').style.display = 'none';
                document.getElementById('compose-view').style.display = 'block';
            }
        }
        
        function deleteEmail() {
            const currentEmailId = parseInt(document.querySelector('.mail-header h3').dataset.id);
            if (currentEmailId) {
                const emailIndex = emails[currentFolder].findIndex(e => e.id === currentEmailId);
                if (emailIndex !== -1) {
                    const deletedEmail = emails[currentFolder].splice(emailIndex, 1)[0];
                    emails.trash.push(deletedEmail);
                    showNotification('E-Mail gel√∂scht');
                    backToInbox();
                }
            }
        }

        // ---------------- Drag & Drop ----------------
        function dragElement(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                elmnt.style.top = (elmnt.offsetTop - pos2) + 'px';
                elmnt.style.left = (elmnt.offsetLeft - pos1) + 'px';
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // ---------------- Hilfsfunktionen ----------------
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            if (type === 'error') {
                notification.classList.add('error');
            }
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Theme aus localStorage laden
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('partex-theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            }
        });
    </script>
</body>
</html>
